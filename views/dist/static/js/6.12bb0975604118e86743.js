webpackJsonp([6],{"+f9w":function(e,t,a){var o=a("xyLT"),i=o.JSON||(o.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},"122/":function(e,t,a){(e.exports=a("5gvp")(!0)).push([e.i,".foot_menu span[data-v-4123265a]{width:20%}#column5.selected[data-v-4123265a]{background:url(/static/img/select-foot-btn5.png) no-repeat center 4px;background-size:25px;color:#c97f8c}#column5[data-v-4123265a]{background:url(/static/img/foot-btn5.png) no-repeat center 4px;background-size:25px}","",{version:3,sources:["/Users/yuxin/Documents/code/wechatForum/views/src/components/footer.vue"],names:[],mappings:"AACA,iCACI,SAAW,CACd,AACD,mCACI,sEAAuE,AACvE,qBAAsB,AACtB,aAAe,CAClB,AACD,0BACI,+DAAgE,AAChE,oBAAsB,CACzB",file:"footer.vue",sourcesContent:["\n.foot_menu span[data-v-4123265a] {\n    width: 20%;\n}\n#column5.selected[data-v-4123265a] {\n    background: url(/static/img/select-foot-btn5.png) no-repeat center 4px;\n    background-size: 25px;\n    color: #c97f8c;\n}\n#column5[data-v-4123265a] {\n    background: url(/static/img/foot-btn5.png) no-repeat center 4px;\n    background-size: 25px;\n}\n"],sourceRoot:""}])},"9j6s":function(e,t,a){"use strict";var o=a("qWzu"),i=a.n(o),n=a("fDr8"),s=a("mzkE");t.a={data:function(){return{tab:{1:!0,2:!1,3:!1},oFormInfo:{typeCode:"",title:"",content:""},aFileImage:[],aFileVideo:[],aFileModifyNewMedia:[],aFileModifyDelMedia:[],oAudio:{},aType:[],sWechatServerAudioId:"",oLocalWechatAudioInfo:{},bIsShowHtmlAudioTag:!1,loc:location.href.split("#")[0],bRecording:!1,bIsShowDelay:!1,oSelectedFile:{}}},created:function(){this.fnGetType(),this.fnDelInvalidMediaFiles()},components:{"my-footer":s.a},methods:{fnGetPostDetails:function(){var e=this,t={};this.aFileImage=[],this.aFileVideo=[],this.aAudios=[],this.oAudio={},t.id=parseFloat(n.a.GetArgsFromHref(this.loc,"id")),t.parmType=1,n.a.ajax("POST",t,"/topic/searchTopicDetail",function(t){var a=JSON.parse(i()(t));e.oPostDetails=a,e.oFormInfo.typeCode=a.typeCode,e.oFormInfo.title=a.title,e.oFormInfo.content=a.content,e.aFileList=a.tFileVos,a.tFileVos.forEach(function(t){1===t.type?(t.path=n.a.baseurl+t.path,e.aFileImage.push(t)):2===t.type?(t.path=n.a.baseurl+t.path.slice(2),e.aFileVideo.push(t)):(t.path=n.a.baseurl+t.path.slice(2),e.oAudio=t)})})},fnGetWechatPermsInfo:function(){var e={};e.message=this.loc,$.ajax({type:"POST",url:"http://www.11wdkj.com/forum/wechatRest/createJsapiSignature",contentType:"application/json",dataType:"json",data:i()(e),success:function(e){wx.config({debug:!1,appId:e.signatrue.appId,timestamp:e.signatrue.timestamp,nonceStr:e.signatrue.nonceStr,signature:e.signatrue.signature,jsApiList:["startRecord","stopRecord","playVoice","uploadVoice","chooseImage"]})}})},fnGetType:function(){var e={},t=this;e.type="TopicType",n.a.ajax("POST",e,"api/getRoleType",function(e){e.forEach(function(e){t.aType.push(e)}),n.a.GetArgsFromHref(t.loc,"mode")&&t.fnGetPostDetails()})},fnPublishPost:function(){var e={},t=this,a="api/",o={};for(var i in this.oFormInfo)if(n.a.verifyIsNull(this.oFormInfo[i].toString()))switch(i){case"typeCode":return void $.alert("请选择类型");case"title":return void $.alert("请填写标题");case"content":return void $.alert("请填写内容")}e.type=this.aType.find(function(e){return e.id==t.oFormInfo.typeCode}).name,e.typeCode=this.oFormInfo.typeCode,e.title=this.oFormInfo.title,e.content=this.oFormInfo.content,e.tFileVos=[],n.a.GetArgsFromHref(this.loc,"mode")?(a+="modifyUserTopic",e.tFileVos=this.aFileModifyNewMedia,e.delFileVos=this.aFileModifyDelMedia,e.id=n.a.GetArgsFromHref(this.loc,"id"),this.sWechatServerAudioId&&(o.audioId=this.sWechatServerAudioId,e.tFileVos.push(o))):(a+="addUserPost",this.aFileImage.forEach(function(t){var a={};a.id=t.id,e.tFileVos.push(a)}),this.aFileVideo.forEach(function(t){var a={};a.id=t.id,e.tFileVos.push(a)}),this.sWechatServerAudioId&&(o.audioId=this.sWechatServerAudioId,e.tFileVos.push(o))),axios.put(a,e).then(function(e){e.data.success?($.alert({title:"提示",text:"提交成功"+(e.data.message?"，"+e.data.message:"")+"!",onOK:function(){t.$router.push("001-home")}}),localStorage.removeItem("aFileImage"),localStorage.removeItem("aFileVideo")):"USER_BAN_CODE"===e.data.message?$.alert("账户禁用，无法操作"):$.alert({title:"提示",text:"发帖失败"})}).catch(function(e){403!==e.response.status&&401!==e.response.status||$.alert("请登录之后再发帖")})},fnDelMedia:function(e,t){var a={},o={},s=this;return n.a.GetArgsFromHref(this.loc,"mode")?("image"===t&&this.aFileImage.forEach(function(t,a){t.id===e&&(s.aFileModifyDelMedia.push(t),s.aFileImage.splice(a,1))}),"video"===t&&this.aFileVideo.forEach(function(t,a){t.id===e&&(s.aFileModifyDelMedia.push(t),s.aFileVideo.splice(a,1))}),void("audio"===t&&(this.aFileModifyDelMedia.push(this.oAudio),this.oAudio={}))):"audio"===t?(this.oLocalWechatAudioInfo={},void(this.sWechatServerAudioId="")):(o.id=e,a.delFileVos=[],a.delFileVos.push(o),void n.a.ajax("DELETE",a,"/wechat/deleteFile",function(a){a.success&&("image"===t&&(s.aFileImage.forEach(function(t,a){t.id===e&&s.aFileImage.splice(a,1)}),localStorage.setItem("aFileImage",i()(s.aFileImage))),"video"===t&&(s.aFileVideo.forEach(function(t,a){t.id===e&&s.aFileVideo.splice(a,1)}),localStorage.setItem("aFileVideo",i()(s.aFileVideo))))}))},fnDelInvalidMediaFiles:function(){var e=JSON.parse(localStorage.getItem("aFileImage")),t=JSON.parse(localStorage.getItem("aFileVideo")),a={delFileVos:[]};if(e||t){e&&e.forEach(function(e){var t={};t.id=e.id,a.delFileVos.push(t)}),t&&t.forEach(function(e){var t={};t.id=e.id,a.delFileVos.push(t)}),n.a.ajax("DELETE",a,"/wechat/deleteFile",function(e){e.success&&(localStorage.removeItem("aFileImage"),localStorage.removeItem("aFileVideo"))})}},fnChangeTab:function(e){for(var t in this.tab)this.tab[t]=!1;this.tab[e]=!0},fnStartRecord:function(){this.bRecording=!0,this.bIsShowDelay=!0,wx.startRecord({success:function(){},cancel:function(){alert("用户拒绝授权录音")}})},fnStopRecord:function(){var e=this;this.bRecording=!1,wx.stopRecord({success:function(t){e.oLocalWechatAudioInfo=t,e.aFileModifyDelMedia.push(e.oAudio),e.oAudio={},wx.uploadVoice({localId:e.oLocalWechatAudioInfo.localId,isShowProgressTips:1,success:function(t){e.sWechatServerAudioId=t.serverId}})}})},fnPlayRecord:function(){wx.playVoice({localId:this.oLocalWechatAudioInfo.localId,success:function(e){console.log(e)}})},fnSelectFile:function(e){var t=this;this.oSelectedFile=e.target.files[0];var a=new FormData;a.append("file",this.oSelectedFile,this.oSelectedFile.name),axios.post("api/uploadImage",a,{onUploadProgress:function(e){console.log("upload progress: "+Math.round(e.loaded/e.total*100)+"%")}}).then(function(a){if(e.target.value="","path"in a.data){if("USER_BAN_CODE"===a.data.path)return void $.alert("账户禁用，无法操作");var o=JSON.parse(i()(a.data));o.path=n.a.baseUrl+"api/getImage/"+o.path,t.aFileImage.push(o),localStorage.setItem("aFileImage",i()(t.aFileImage)),n.a.GetArgsFromHref(t.loc,"mode")&&t.aFileModifyNewMedia.push(o)}}).catch(console.log)},fnWechatChooseImg:function(){wx.chooseImage({count:1,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(e){console.log("chooseSuccess"),e.localIds}})}},mounted:function(){},updated:function(){this.$nextTick(function(){var e=$(window).get(0).innerWidth;$(".post_img").css("height",.94*e*.23),$(".post_img img").css("height",.94*e*.23),$(".add_img_btn").css("height",.94*e*.23),$(".ts_box").css("height",.94*e*.23)})}}},FDSE:function(e,t,a){var o=a("122/");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals),a("P+mm")("852d7f26",o,!0,{})},NtTm:function(e,t,a){"use strict";var o={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",{attrs:{id:"send"}},[o("div",{staticClass:"send_top"},[o("div",[o("select",{directives:[{name:"model",rawName:"v-model",value:e.oFormInfo.typeCode,expression:"oFormInfo.typeCode"}],staticClass:"post_title_input",staticStyle:{"padding-left":"0px"},on:{change:function(t){var a=Array.prototype.filter.call(t.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});e.$set(e.oFormInfo,"typeCode",t.target.multiple?a:a[0])}}},[o("option",{attrs:{value:""}},[e._v("请选择类别")]),e._v(" "),e._l(e.aType,function(t){return o("option",{domProps:{value:t.id,textContent:e._s(t.name)}})})],2)]),e._v(" "),o("input",{directives:[{name:"model",rawName:"v-model",value:e.oFormInfo.title,expression:"oFormInfo.title"}],staticClass:"post_title_input",attrs:{placeholder:"请输入标题"},domProps:{value:e.oFormInfo.title},on:{input:function(t){t.target.composing||e.$set(e.oFormInfo,"title",t.target.value)}}}),e._v(" "),o("textarea",{directives:[{name:"model",rawName:"v-model",value:e.oFormInfo.content,expression:"oFormInfo.content"}],staticClass:"post_textarea",attrs:{placeholder:"请输入内容"},domProps:{value:e.oFormInfo.content},on:{input:function(t){t.target.composing||e.$set(e.oFormInfo,"content",t.target.value)}}}),e._v(" "),o("div",{staticClass:"post_medias"},[e._l(e.aFileImage,function(t){return o("div",{staticClass:"post_img"},[o("img",{attrs:{id:"imgID"+t.id,src:t.path}}),e._v(" "),o("span",{staticClass:"delete_img_btn ripple_box",on:{click:function(a){e.fnDelMedia(t.id,"image")}}})])}),e._v(" "),e._l(e.aFileVideo,function(t){return o("div",{staticClass:"post_img"},[o("img",{attrs:{id:"videoId"+t.id,src:a("pBxU")}}),e._v(" "),o("span",{staticClass:"delete_img_btn ripple_box",on:{click:function(a){e.fnDelMedia(t.id,"video")}}})])})],2),e._v(" "),o("div",{staticClass:"post_medias"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.oLocalWechatAudioInfo.localId,expression:"oLocalWechatAudioInfo.localId"}],staticClass:"post_play"},[o("div",{staticClass:"record_square",on:{click:e.fnPlayRecord}},[o("i",{staticClass:"ion-play"})]),e._v(" "),o("span",{staticClass:"delete_img_btn2 ripple_box",on:{click:function(t){e.fnDelMedia("id","audio")}}})]),e._v(" "),e.oAudio.path?o("audio",{attrs:{src:e.oAudio.path,controls:""}}):e._e(),e._v(" "),e.oAudio.path?o("span",{staticClass:"delete_img_btn2 ripple_box",on:{click:function(t){e.fnDelMedia("id","audio")}}}):e._e()])]),e._v(" "),o("div",{staticClass:"send_bottom"},[o("div",{staticClass:"medias_tab_btns"},[o("span",{staticClass:"medias_tab_btn",class:{selected:e.tab[1]},on:{click:function(t){e.fnChangeTab(1)}}},[o("i",{staticClass:"ion-android-image"})])]),e._v(" "),o("div",{staticClass:"post_medias"},[o("div",{directives:[{name:"show",rawName:"v-show",value:e.tab[1],expression:"tab[1]"}]},[o("span",{staticClass:"add_img_btn"},[o("input",{attrs:{id:"fileImage",name:"file",type:"file",accept:"image/*",multiple:""},on:{change:e.fnSelectFile}})])]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.tab[2],expression:"tab[2]"}]},[e._m(0),e._v(" "),o("span",{staticClass:"ts_box"},[e._v("\n                提示：支持标清30秒左右(100秒以内)本地小视频\n            ")])]),e._v(" "),o("div",{directives:[{name:"show",rawName:"v-show",value:e.tab[3],expression:"tab[3]"}]},[e.bRecording?o("span",{staticClass:"send_btn2 stop_record",on:{click:e.fnStopRecord}},[e._v("停止录音")]):o("span",{staticClass:"send_btn2",on:{click:e.fnStartRecord}},[e._v("点击录音")])])])]),e._v(" "),o("span",{staticClass:"send_btn ripple_box",on:{click:e.fnPublishPost}},[e._v("确认发送")]),e._v(" "),o("div",{staticStyle:{height:"50px",width:"100%",float:"left"}}),e._v(" "),o("my-footer",{attrs:{"my-tab":"3"}})],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("span",{staticClass:"add_img_btn"},[t("input",{attrs:{id:"fileVideo",name:"filename",type:"file",accept:"video/*",multiple:""}})])}]};t.a=o},XcQt:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("9j6s"),i=a("NtTm"),n=function(e){a("YIea")},s=a("U5Ua")(o.a,i.a,!1,n,"data-v-1beb71c1",null);t.default=s.exports},YIea:function(e,t,a){var o=a("jQrc");"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals),a("P+mm")("457409d6",o,!0,{})},fDr8:function(e,t,a){"use strict";function o(){this.baseUrl="http://localhost:3000/"}a.d(t,"a",function(){return s});var i=a("qWzu"),n=a.n(i);o.prototype.ajax=function(e,t,a,o,i){var s=this.fnCreateXHR(),r="";r="http"===a.toLowerCase().slice(0,4)?a:this.baseUrl+a,"get"===e.toLowerCase()&&(r+=t?"?"+n()(t):""),s.open(e,r,!0),"get"!==e.toLowerCase()&&s.setRequestHeader("Content-type","application/json"),s.withCredentials=i||!1,s.onreadystatechange=function(){4===s.readyState&&/^2\d{2}$/.test(s.status)&&o(JSON.parse(s.responseText))},s.send(n()(t)||null)},o.prototype.fnCreateXHR=function(){for(var e=!1,t=null,a=[function(){return new XMLHttpRequest},function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml3.XMLHTTP")}],o=0,i=a.length;o<i;o++){var n=a[o];try{t=n(),this.fnCreateXHR=n,e=!0;break}catch(e){}}if(!e)throw new Error("不支持ajax哦亲！您使用的可能是传说中的浏览器");return t},o.prototype.fnAllImgDelayLoad=function(e){var t=document.getElementsByTagName("img");for(var a in t)isNaN(a)||t[a].isLoaded||function(t){var a=t.getAttribute("true-src"),o=new Image;a&&(o.src=a,o.onload=function(){if(t.src=a,t.isLoaded=!0,e&&"A"===t.parentNode.tagName){var i=o.width+"x"+o.height;t.parentNode.setAttribute("data-size",i),t.parentNode.setAttribute("data-med-size",i)}o=null})}(t[a])},o.prototype.rippleFunction=function(e){var t=e.target;if(-1===t.className.indexOf("ripple_box"))return!1;var a=t.getBoundingClientRect(),o=t.querySelector(".ripple");o||((o=document.createElement("span")).className="ripple",o.style.height=o.style.width=Math.max(a.width,a.height)+"px",t.appendChild(o)),o.classList.remove("show");var i=e.pageY-a.top-o.offsetHeight/2-document.body.scrollTop,n=e.pageX-a.left-o.offsetWidth/2-document.body.scrollLeft;return o.style.top=i+"px",o.style.left=n+"px",o.classList.add("show"),!1},o.prototype.GetArgsFromHref=function(e,t){var a=e.split("?"),o="";if(a[0]==e)return o;var i=a[1];a=i.split("&");for(var n=0;n<a.length;n++){var s=(i=a[n]).split("=");s.length<=1||s[0]==t&&(o=s[1])}return o},o.prototype.verifyIsNull=function(e){return void 0==(e=e.replace(/\s+/g,""))||""==e||null==e},o.prototype.isPassive=function(){var e=!1;try{addEventListener("test",null,Object.defineProperty({},"passive",{get:function(){e=!0}}))}catch(e){}return e};var s=new o;document.ready=function(){},document.addEventListener("click",s.rippleFunction,!1)},gizR:function(e,t,a){"use strict";t.a={data:function(){return{}},props:["myTab"],created:function(){},methods:{},mounted:function(){},updated:function(){}}},"h/ZX":function(e,t,a){"use strict";var o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{},[a("div",{staticClass:"foot_menu"},[a("router-link",{attrs:{to:"/001-home"}},[a("span",{class:{ripple_box:!0,selected:"1"==e.myTab},attrs:{id:"column1"}},[e._v("首页")])]),e._v(" "),a("router-link",{attrs:{to:"/002-score"}},[a("span",{class:{ripple_box:!0,selected:"2"==e.myTab},attrs:{id:"column2"}},[e._v("赚积分")])]),e._v(" "),a("router-link",{attrs:{to:"/003-send"}},[a("span",{class:{ripple_box:!0,selected:"3"==e.myTab},attrs:{id:"column3"}},[e._v("发帖")])]),e._v(" "),a("router-link",{attrs:{to:"/004-my"}},[a("span",{class:{ripple_box:!0,selected:"4"==e.myTab},attrs:{id:"column4"}},[e._v("我的")])]),e._v(" "),a("router-link",{attrs:{to:"/019-chat"}},[a("span",{class:{ripple_box:!0,selected:"5"==e.myTab},attrs:{id:"column5"}},[e._v("聊天室")])])],1)])},staticRenderFns:[]};t.a=o},jQrc:function(e,t,a){(e.exports=a("5gvp")(!0)).push([e.i,".add_img_btn[data-v-1beb71c1]{border:none}.add_img_btn input[data-v-1beb71c1]{height:80px}.stop_record[data-v-1beb71c1]{background-color:#0aa5df}.post_textarea[data-v-1beb71c1],.post_title_input[data-v-1beb71c1]{margin-left:0}.medias_tab_btn[data-v-1beb71c1]{float:left;margin-left:5px}[v-cloak][data-v-1beb71c1]{display:none}","",{version:3,sources:["/Users/yuxin/Documents/code/wechatForum/views/src/pages/003-send.vue"],names:[],mappings:"AACA,8BACI,WAAa,CAChB,AACD,oCACI,WAAa,CAChB,AACD,8BACI,wBAA0B,CAC7B,AACD,mEAEE,aAAiB,CAClB,AACD,iCACI,WAAY,AACZ,eAAiB,CACpB,AACD,2BACI,YAAc,CACjB",file:"003-send.vue",sourcesContent:["\n.add_img_btn[data-v-1beb71c1] {\n    border: none;\n}\n.add_img_btn input[data-v-1beb71c1] {\n    height: 80px;\n}\n.stop_record[data-v-1beb71c1] {\n    background-color: #0aa5df;\n}\n.post_title_input[data-v-1beb71c1],\n.post_textarea[data-v-1beb71c1] {\n  margin-left: 0px;\n}\n.medias_tab_btn[data-v-1beb71c1] {\n    float: left;\n    margin-left: 5px;\n}\n[v-cloak][data-v-1beb71c1] {\n    display: none;\n}\n"],sourceRoot:""}])},mzkE:function(e,t,a){"use strict";var o=a("gizR"),i=a("h/ZX"),n=function(e){a("FDSE")},s=a("U5Ua")(o.a,i.a,!1,n,"data-v-4123265a",null);t.a=s.exports},pBxU:function(e,t,a){e.exports=a.p+"static/img/video_player.0f155db.jpg"},qWzu:function(e,t,a){e.exports={default:a("+f9w"),__esModule:!0}},xyLT:function(e,t){var a=e.exports={version:"2.5.3"};"number"==typeof __e&&(__e=a)}});